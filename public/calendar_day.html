<!DOCTYPE html>
<html lang="fr">
<style>
    .container {
        height: "100px";
    }

    .vuecal__cell-events {
        display: flex !important;
        justify-content: center !important;
        align-items: center !important;
        padding: 4px;
    }

    .vuecal_event {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 4px;
    }

    em {
        font-size: 0.8em;
        color: #999;
    }

    .subject-1 {
        background-color: lightblue !important;
    }

    .subject-2 {
        background-color: lightsteelblue !important;
    }

    .subject-3 {
        background-color: lightgoldenrodyellow !important;
    }

    .subject-4 {
        background-color: lightslategray !important;
    }

    .subject-5 {
        background-color: lightcoral !important;
    }

    .subject-6 {
        background-color: lightgreen !important;
    }

    .subject-7 {
        background-color: lightseagreen !important;
    }

    .subject-8 {
        background-color: lightyellow !important;
    }

    .subject-9 {
        background-color: lightpink !important;
    }

    .subject-10 {
        background-color: lightskyblue !important;
    }

    .closed {
        background:
            #fff7f0 repeating-linear-gradient(-45deg,
                rgba(255, 162, 87, 0.25),
                rgba(255, 162, 87, 0.25) 5px,
                rgba(255, 255, 255, 0) 5px,
                rgba(255, 255, 255, 0) 15px);
        color: #f6984c;
    }

    .vuecal__event.lunch {
        background: repeating-linear-gradient(45deg, transparent, transparent 10px, #f2f2f2 10px, #f2f2f2 20px);
        /* IE 10+ */
        color: #999;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .vuecal__event.lunch .vuecal__event-time {
        display: none;
        justify-content: center !important;
        align-items: center;
    }
    .btnSuivant{
        background-color: #f6984c;
        color: white;
        border: none;
        border-radius: 5px;
        padding: 5px;
        margin: 5px;
    }

</style>

<head>
    <title>Schedule</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://unpkg.com/vue"></script>
    <script src="https://unpkg.com/vue-cal"></script>
    <script src="https://unpkg.com/axios"></script>
    <link href="https://unpkg.com/vue-cal/dist/vuecal.css" rel="stylesheet">
</head>

<body>
    <div id="app" class="container">
            <br />


        <vue-cal class="vuecal--blue-theme" :time-from="8 * 60" :time-to="18 * 60 + 30" :time-step="30"
            :disable-views="['years', 'year', 'month']" hide-weekends :events="events" cell-contextmenu
            ref="vuecal"
            v-model:active-view="activeView"
            v-model:selected-date="selectedDate"

            

            @view-change="viewChange($event)" 
            @cell-click="logChange('cell-click', $event)"

            @cell-dblclick="logChange('cell-dblclick', $event)"

            @cell-contextmenu="logChange('cell-contextmenu', $event)"
            >

            
    </div>

    <script type="text/javascript">



        Vue.createApp({
            components: { VueCal: vuecal },
            el: '#app',
            activeView: 'week',
            today: null,
            midBreakStart: null,
            selectedDate: null,
            data: () => ({
                events: [],
                lessons: [],
                color: [
                ],
                i: 0,
            }),
            methods: {
                getLessonsByDay: function (date) {
                    this.erros = [];
                    
                    axios.post("http://localhost:8000/api/lesson/date/day", { date: date })
                        .then(response => {
                            this.lessons = response.data;
                            this.lessons.forEach((lesson) => this.addToTab(lesson));
                        })
                        .catch(error => {
                            console.log(error)
                        })
                },

                getLessonsByWeek: function(startDate, endDate){
                    this.erros = [];
                    
                    axios.post("http://localhost:8000/api/lesson/date/week", { startDate: startDate, endDate: endDate }) 
                        .then(response => {
                            this.lessons = response.data;
                            this.lessons.forEach((lesson) => this.addToTab(lesson));
                        })
                        .catch(error => {
                            console.log(error)
                        })
                },
                
                addToTab: function (lesson) {
                    var htmlClass = null;
                    if (!this.color.find((color) => color.id == lesson.subject.id)) {
                        this.i++
                        htmlClass = 'subject-' + this.i;

                        this.color.push({
                            id: lesson.subject.id,
                            class: htmlClass
                        })

                    } else {
                        htmlClass = this.color.find((color) => color.id == lesson.subject.id).class;
                    }
                    //this.affichage(htmlClass, this.i, this.color)

                    this.events.push({
                        start: lesson.startDateTime.date,
                        end: lesson.endDateTime.date,
                        title: lesson.subject.title + ' ' + lesson.teacher.name + ' ' + lesson.room.number,
                        content: '',
                        class: htmlClass
                    })
                },

                affichage: function (htmlclass, i, color) {
                    console.log('htmlclass :' + htmlclass);
                    console.log('color :' + this.color);
                    console.log('i : ' + this.i);
                },

                logChange: function (view, event) {
                    console.log(event);
                },
                switchView(jour, date) {
                    console.log('switchView')
                },

                viewChange: function (event) {
                    this.events = [];

                    var view = event['view'];
                    // var time = new Date().getTime();
                    // var date = new Date(time);
                    var date = new Date(event['startDate'])
                    date.setHours(9)
                    
                    console.log(event)
                    switch (view) {
                        case 'day':
                            this.getLessonsByDay(date);
                            break;
                        case 'week':
                            this.getLessonsByWeek(new Date(event['startDate']), new Date(event['endDate']));
                            break;
                    }
                }

            },
        }).mount('#app')
    </script>
</body>